!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).xAppSdk=e()}}((function(){return function e(t,n,r){function o(s,a){if(!n[s]){if(!t[s]){var u="function"==typeof require&&require;if(!a&&u)return u(s,!0);if(i)return i(s,!0);var l=new Error("Cannot find module '"+s+"'");throw l.code="MODULE_NOT_FOUND",l}var c=n[s]={exports:{}};t[s][0].call(c.exports,(function(e){return o(t[s][1][e]||e)}),c,c.exports,e,t,n,r)}return n[s].exports}for(var i="function"==typeof require&&require,s=0;s<r.length;s++)o(r[s]);return o}({1:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.xAppEvents=void 0,function(e){e.scanQr="scanQr",e.payloadResolved="payloadResolved",e.selectDestination="selectDestination"}(n.xAppEvents||(n.xAppEvents={}))},{}],2:[function(e,t,n){var r=Object.create||function(e){var t=function(){};return t.prototype=e,new t},o=Object.keys||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.push(n);return n},i=Function.prototype.bind||function(e){var t=this;return function(){return t.apply(e,arguments)}};function s(){this._events&&Object.prototype.hasOwnProperty.call(this,"_events")||(this._events=r(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0}t.exports=s,s.EventEmitter=s,s.prototype._events=void 0,s.prototype._maxListeners=void 0;var a,u=10;try{var l={};Object.defineProperty&&Object.defineProperty(l,"x",{value:0}),a=0===l.x}catch(e){a=!1}function c(e){return void 0===e._maxListeners?s.defaultMaxListeners:e._maxListeners}function p(e,t,n){if(t)e.call(n);else for(var r=e.length,o=A(e,r),i=0;i<r;++i)o[i].call(n)}function f(e,t,n,r){if(t)e.call(n,r);else for(var o=e.length,i=A(e,o),s=0;s<o;++s)i[s].call(n,r)}function d(e,t,n,r,o){if(t)e.call(n,r,o);else for(var i=e.length,s=A(e,i),a=0;a<i;++a)s[a].call(n,r,o)}function v(e,t,n,r,o,i){if(t)e.call(n,r,o,i);else for(var s=e.length,a=A(e,s),u=0;u<s;++u)a[u].call(n,r,o,i)}function h(e,t,n,r){if(t)e.apply(n,r);else for(var o=e.length,i=A(e,o),s=0;s<o;++s)i[s].apply(n,r)}function m(e,t,n,o){var i,s,a;if("function"!=typeof n)throw new TypeError('"listener" argument must be a function');if((s=e._events)?(s.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),s=e._events),a=s[t]):(s=e._events=r(null),e._eventsCount=0),a){if("function"==typeof a?a=s[t]=o?[n,a]:[a,n]:o?a.unshift(n):a.push(n),!a.warned&&(i=c(e))&&i>0&&a.length>i){a.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+a.length+' "'+String(t)+'" listeners added. Use emitter.setMaxListeners() to increase limit.');u.name="MaxListenersExceededWarning",u.emitter=e,u.type=t,u.count=a.length,"object"==typeof console&&console.warn&&console.warn("%s: %s",u.name,u.message)}}else a=s[t]=n,++e._eventsCount;return e}function y(){if(!this.fired)switch(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length){case 0:return this.listener.call(this.target);case 1:return this.listener.call(this.target,arguments[0]);case 2:return this.listener.call(this.target,arguments[0],arguments[1]);case 3:return this.listener.call(this.target,arguments[0],arguments[1],arguments[2]);default:for(var e=new Array(arguments.length),t=0;t<e.length;++t)e[t]=arguments[t];this.listener.apply(this.target,e)}}function g(e,t,n){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},o=i.call(y,r);return o.listener=n,r.wrapFn=o,o}function x(e,t,n){var r=e._events;if(!r)return[];var o=r[t];return o?"function"==typeof o?n?[o.listener||o]:[o]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(o):A(o,o.length):[]}function w(e){var t=this._events;if(t){var n=t[e];if("function"==typeof n)return 1;if(n)return n.length}return 0}function A(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e[r];return n}a?Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return u},set:function(e){if("number"!=typeof e||e<0||e!=e)throw new TypeError('"defaultMaxListeners" must be a positive number');u=e}}):s.defaultMaxListeners=u,s.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=e,this},s.prototype.getMaxListeners=function(){return c(this)},s.prototype.emit=function(e){var t,n,r,o,i,s,a="error"===e;if(s=this._events)a=a&&null==s.error;else if(!a)return!1;if(a){if(arguments.length>1&&(t=arguments[1]),t instanceof Error)throw t;var u=new Error('Unhandled "error" event. ('+t+")");throw u.context=t,u}if(!(n=s[e]))return!1;var l="function"==typeof n;switch(r=arguments.length){case 1:p(n,l,this);break;case 2:f(n,l,this,arguments[1]);break;case 3:d(n,l,this,arguments[1],arguments[2]);break;case 4:v(n,l,this,arguments[1],arguments[2],arguments[3]);break;default:for(o=new Array(r-1),i=1;i<r;i++)o[i-1]=arguments[i];h(n,l,this,o)}return!0},s.prototype.addListener=function(e,t){return m(this,e,t,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(e,t){return m(this,e,t,!0)},s.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.on(e,g(this,e,t)),this},s.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.prependListener(e,g(this,e,t)),this},s.prototype.removeListener=function(e,t){var n,o,i,s,a;if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');if(!(o=this._events))return this;if(!(n=o[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=r(null):(delete o[e],o.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(i=-1,s=n.length-1;s>=0;s--)if(n[s]===t||n[s].listener===t){a=n[s].listener,i=s;break}if(i<0)return this;0===i?n.shift():function(e,t){for(var n=t,r=n+1,o=e.length;r<o;n+=1,r+=1)e[n]=e[r];e.pop()}(n,i),1===n.length&&(o[e]=n[0]),o.removeListener&&this.emit("removeListener",e,a||t)}return this},s.prototype.removeAllListeners=function(e){var t,n,i;if(!(n=this._events))return this;if(!n.removeListener)return 0===arguments.length?(this._events=r(null),this._eventsCount=0):n[e]&&(0==--this._eventsCount?this._events=r(null):delete n[e]),this;if(0===arguments.length){var s,a=o(n);for(i=0;i<a.length;++i)"removeListener"!==(s=a[i])&&this.removeAllListeners(s);return this.removeAllListeners("removeListener"),this._events=r(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(t)for(i=t.length-1;i>=0;i--)this.removeListener(e,t[i]);return this},s.prototype.listeners=function(e){return x(this,e,!0)},s.prototype.rawListeners=function(e){return x(this,e,!1)},s.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):w.call(e,t)},s.prototype.listenerCount=w,s.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]}},{}],xApp:[function(e,t,n){"use strict";var r,o=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var o=Object.getOwnPropertyDescriptor(t,n);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,o)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||o(t,e,n)},s=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{u(r.next(e))}catch(e){i(e)}}function a(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}u((r=r.apply(e,t||[])).next())}))};Object.defineProperty(n,"__esModule",{value:!0}),n.xApp=void 0;const a=e("events"),u=e("./types");i(e("./types"),n);const l=.25,c=Number(new Date);let p;const f=new Promise((e=>{p=t=>{console.log("Doc Ready...");const n=(Number(new Date)-c)/1e3;n<l?(console.log("Doc not alive >= 0.25 sec, stalling for "+(l-n)),setTimeout((function(){e(t)}),1e3*(l-n))):(console.log("Doc alive 0.25+ sec, go ahead"),e(t))}}));f.then((()=>{console.log("documentReadyPromise resolved")})).catch((e=>{console.log(e)})),"undefined"!=typeof document&&document.addEventListener("readystatechange",(e=>{console.log("(readystatechange: [ "+document.readyState+" ])"),"complete"===document.readyState&&p()})),"undefined"!=typeof window&&console.log("Loading xApp SDK");let d="undefined"!=typeof window?window:{},v=!1;(null==d?void 0:d.parent)&&(null===(r=d.parent)||void 0===r||r.postMessage("XAPP_PROXY_INIT","*"));const h=(e,t,n=0)=>s(void 0,void 0,void 0,(function*(){var r,o;if(yield f,void 0!==(null==d?void 0:d.ReactNativeWebView)||v){const n=(Number(new Date)-c)/1e3;if(["close"].indexOf(e)>-1){const e=4;n<e&&(console.log("xApp close, doc alive < minAliveTimeSec, stall: "+(e-n)),yield new Promise((t=>{setTimeout((()=>{t(!0)}),1e3*(e-n))})))}const i=JSON.stringify(Object.assign({command:e},t||{}));return v?null===(r=d.parent)||void 0===r||r.postMessage(i,"*"):null===(o=d.ReactNativeWebView)||void 0===o||o.postMessage(i),console.log("xAppActionAttempt Success",e,t),!0}return 250*n<2e3?(console.log("xAppActionAttempt Attempt "+n+" Â» Retry",e,t),yield new Promise((e=>{setTimeout(e,250)})),h(e,t,n+1)):(console.log("xAppActionAttempt Failed after attempt "+n,e,t),new Error("xApp."+e.replace(/^xApp/,"")+": could not contact Xumm App Host"))}));class m extends a.EventEmitter{constructor(){super(),"complete"===document.readyState&&p();const e=e=>{const t=e;if("string"==typeof(null==t?void 0:t.data)&&"XAPP_PROXY_INIT_ACK"===t.data)return console.log("xApp Proxy ACK received, switching to PROXY (SANDBOX) mode"),void(v=!0);try{const e=JSON.parse((null==t?void 0:t.data)||"{}");if(console.log({_event:e}),"object"==typeof e&&null!==e)if("string"==typeof e.method&&e.method in u.xAppEvents){console.log("xApp Event received",e.method,e);const t=e.method;switch(delete e.method,t){case String(u.xAppEvents.payloadResolved):this.emit("payload",e);break;case String(u.xAppEvents.scanQr):this.emit("qr",e);break;case String(u.xAppEvents.selectDestination):this.emit("destination",e)}}else console.log("xApp Event received, not in xAppEvents",e.method,u.xAppEvents)}catch(e){const t=(null==e?void 0:e.message)||"";t.match(/XAPP_PROXY_INIT/)||console.log("xApp Event received, cannot parse as JSON",t)}};"function"==typeof window.addEventListener&&window.addEventListener("message",e),"function"==typeof document.addEventListener&&document.addEventListener("message",e)}getEnvironment(){const e=y();return e?e.getEnvironment():{version:"",ott:""}}navigate(e){return"string"!=typeof(null==e?void 0:e.xApp)?Promise.reject(new Error("xApp.navigate: Invalid argument: `xApp`")):h("xAppNavigate",e)}openSignRequest(e){return"string"!=typeof(null==e?void 0:e.uuid)?Promise.reject(new Error("xApp.openSignRequest: Invalid argument: `uuid`")):e.uuid.match(/^[0-9A-F]{8}-[0-9A-F]{4}-4[0-9A-F]{3}-[89AB][0-9A-F]{3}-[0-9A-F]{12}$/i)?h("openSignRequest",e):Promise.reject(new Error("xApp.openSignRequest: Invalid payload UUID"))}selectDestination(e){return h("selectDestination",e)}openBrowser(e){return"string"!=typeof(null==e?void 0:e.url)?Promise.reject(new Error("xApp.openBrowser: Invalid argument: `url`")):h("openBrowser",e)}share(e){return"string"!=typeof(null==e?void 0:e.text)?Promise.reject(new Error("xApp.share: Invalid argument: `text`")):h("share",e)}scanQr(){return h("scanQr")}tx(e){return"string"!=typeof(null==e?void 0:e.tx)?Promise.reject(new Error("xApp.tx: Invalid argument: `tx`")):"string"!=typeof(null==e?void 0:e.account)?Promise.reject(new Error("xApp.tx: Invalid argument: `account`")):h("txDetails",e)}close(e){return h("close",e)}ready(){return h("ready")}customCommand(e,t){return h(e,t)}}const y=e=>{let t=!1;e&&"object"==typeof d&&void 0===d._xAppSdk&&(d._xAppSdk=e,t=!0);const n=null==d?void 0:d._xAppSdk;return n&&t&&console.log("xAppSdk attached to window"),n};class g{constructor(){if(this.xummEnvironment={version:"",ott:""},"undefined"!=typeof window&&"undefined"!=typeof document){if("undefined"!=typeof navigator&&"string"==typeof(null===navigator||void 0===navigator?void 0:navigator.userAgent)){const e=navigator.userAgent.trim().match(/xumm\/xapp:([0-9]{1,}\.[0-9]{1,}\.[0-9]{1,}).*ott:([0-9a-f]{8}-[0-9a-f]{4}-4[0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12})/);e&&(this.xummEnvironment.version=e[1],this.xummEnvironment.ott=e[2])}""===this.xummEnvironment.version&&console.log("Warning: Xumm Version could not be retrieved from User Agent, possibly not loaded in xApp context?"),y()||y(new m)}}getEnvironment(){return this.xummEnvironment}on(e,t){const n=y();if(n)return n.on(e,t),this}off(e,t){const n=y();if(n)return n.off(e,t),this}navigate(e){const t=y();if(t)return t.navigate(e)}openSignRequest(e){const t=y();if(t&&(null==e?void 0:e.uuid))return t.openSignRequest(e)}selectDestination(e){const t=y();if(t)return t.selectDestination(e)}openBrowser(e){const t=y();if(t)return t.openBrowser(e)}share(e){const t=y();if(t)return t.share(e)}scanQr(){const e=y();if(e)return e.scanQr()}tx(e){const t=y();if(t)return t.tx(e)}close(e){const t=y();if(t)return t.close(e)}ready(){const e=y();if(e)return e.ready()}customCommand(e,t){const n=y();if(n)return n.customCommand(e,t)}}n.xApp=g,t.exports=g},{"./types":1,events:2}]},{},[])("xApp")})),new xAppSdk;
