require=function e(t,n,i){function r(s,l){if(!n[s]){if(!t[s]){var u="function"==typeof require&&require;if(!l&&u)return u(s,!0);if(o)return o(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var a=n[s]={exports:{}};t[s][0].call(a.exports,(function(e){return r(t[s][1][e]||e)}),a,a.exports,e,t,n,i)}return n[s].exports}for(var o="function"==typeof require&&require,s=0;s<i.length;s++)r(i[s]);return r}({1:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0})},{}],2:[function(e,t,n){(function(n){(function(){"use strict";var i=e("object-assign");
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
 * @license  MIT
 */function r(e,t){if(e===t)return 0;for(var n=e.length,i=t.length,r=0,o=Math.min(n,i);r<o;++r)if(e[r]!==t[r]){n=e[r],i=t[r];break}return n<i?-1:i<n?1:0}function o(e){return n.Buffer&&"function"==typeof n.Buffer.isBuffer?n.Buffer.isBuffer(e):!(null==e||!e._isBuffer)}var s=e("util/"),l=Object.prototype.hasOwnProperty,u=Array.prototype.slice,c="foo"===function(){}.name;function a(e){return Object.prototype.toString.call(e)}function d(e){return!o(e)&&("function"==typeof n.ArrayBuffer&&("function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):!!e&&(e instanceof DataView||!!(e.buffer&&e.buffer instanceof ArrayBuffer))))}var f=t.exports=y,p=/\s*function\s+([^\(\s]*)\s*/;function v(e){if(s.isFunction(e)){if(c)return e.name;var t=e.toString().match(p);return t&&t[1]}}function h(e,t){return"string"==typeof e?e.length<t?e:e.slice(0,t):e}function m(e){if(c||!s.isFunction(e))return s.inspect(e);var t=v(e);return"[Function"+(t?": "+t:"")+"]"}function g(e,t,n,i,r){throw new f.AssertionError({message:n,actual:e,expected:t,operator:i,stackStartFunction:r})}function y(e,t){e||g(e,!0,t,"==",f.ok)}function b(e,t,n,i){if(e===t)return!0;if(o(e)&&o(t))return 0===r(e,t);if(s.isDate(e)&&s.isDate(t))return e.getTime()===t.getTime();if(s.isRegExp(e)&&s.isRegExp(t))return e.source===t.source&&e.global===t.global&&e.multiline===t.multiline&&e.lastIndex===t.lastIndex&&e.ignoreCase===t.ignoreCase;if(null!==e&&"object"==typeof e||null!==t&&"object"==typeof t){if(d(e)&&d(t)&&a(e)===a(t)&&!(e instanceof Float32Array||e instanceof Float64Array))return 0===r(new Uint8Array(e.buffer),new Uint8Array(t.buffer));if(o(e)!==o(t))return!1;var l=(i=i||{actual:[],expected:[]}).actual.indexOf(e);return-1!==l&&l===i.expected.indexOf(t)||(i.actual.push(e),i.expected.push(t),function(e,t,n,i){if(null==e||null==t)return!1;if(s.isPrimitive(e)||s.isPrimitive(t))return e===t;if(n&&Object.getPrototypeOf(e)!==Object.getPrototypeOf(t))return!1;var r=C(e),o=C(t);if(r&&!o||!r&&o)return!1;if(r)return b(e=u.call(e),t=u.call(t),n);var l,c,a=O(e),d=O(t);if(a.length!==d.length)return!1;for(a.sort(),d.sort(),c=a.length-1;c>=0;c--)if(a[c]!==d[c])return!1;for(c=a.length-1;c>=0;c--)if(!b(e[l=a[c]],t[l],n,i))return!1;return!0}(e,t,n,i))}return n?e===t:e==t}function C(e){return"[object Arguments]"==Object.prototype.toString.call(e)}function w(e,t){if(!e||!t)return!1;if("[object RegExp]"==Object.prototype.toString.call(t))return t.test(e);try{if(e instanceof t)return!0}catch(e){}return!Error.isPrototypeOf(t)&&!0===t.call({},e)}function _(e,t,n,i){var r;if("function"!=typeof t)throw new TypeError('"block" argument must be a function');"string"==typeof n&&(i=n,n=null),r=function(e){var t;try{e()}catch(e){t=e}return t}(t),i=(n&&n.name?" ("+n.name+").":".")+(i?" "+i:"."),e&&!r&&g(r,n,"Missing expected exception"+i);var o="string"==typeof i,l=!e&&r&&!n;if((!e&&s.isError(r)&&o&&w(r,n)||l)&&g(r,n,"Got unwanted exception"+i),e&&r&&n&&!w(r,n)||!e&&r)throw r}f.AssertionError=function(e){this.name="AssertionError",this.actual=e.actual,this.expected=e.expected,this.operator=e.operator,e.message?(this.message=e.message,this.generatedMessage=!1):(this.message=function(e){return h(m(e.actual),128)+" "+e.operator+" "+h(m(e.expected),128)}(this),this.generatedMessage=!0);var t=e.stackStartFunction||g;if(Error.captureStackTrace)Error.captureStackTrace(this,t);else{var n=new Error;if(n.stack){var i=n.stack,r=v(t),o=i.indexOf("\n"+r);if(o>=0){var s=i.indexOf("\n",o+1);i=i.substring(s+1)}this.stack=i}}},s.inherits(f.AssertionError,Error),f.fail=g,f.ok=y,f.equal=function(e,t,n){e!=t&&g(e,t,n,"==",f.equal)},f.notEqual=function(e,t,n){e==t&&g(e,t,n,"!=",f.notEqual)},f.deepEqual=function(e,t,n){b(e,t,!1)||g(e,t,n,"deepEqual",f.deepEqual)},f.deepStrictEqual=function(e,t,n){b(e,t,!0)||g(e,t,n,"deepStrictEqual",f.deepStrictEqual)},f.notDeepEqual=function(e,t,n){b(e,t,!1)&&g(e,t,n,"notDeepEqual",f.notDeepEqual)},f.notDeepStrictEqual=function e(t,n,i){b(t,n,!0)&&g(t,n,i,"notDeepStrictEqual",e)},f.strictEqual=function(e,t,n){e!==t&&g(e,t,n,"===",f.strictEqual)},f.notStrictEqual=function(e,t,n){e===t&&g(e,t,n,"!==",f.notStrictEqual)},f.throws=function(e,t,n){_(!0,e,t,n)},f.doesNotThrow=function(e,t,n){_(!1,e,t,n)},f.ifError=function(e){if(e)throw e},f.strict=i((function e(t,n){t||g(t,!0,n,"==",e)}),f,{equal:f.strictEqual,deepEqual:f.deepStrictEqual,notEqual:f.notStrictEqual,notDeepEqual:f.notDeepStrictEqual}),f.strict.strict=f.strict;var O=Object.keys||function(e){var t=[];for(var n in e)l.call(e,n)&&t.push(n);return t}}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"object-assign":11,"util/":5}],3:[function(e,t,n){"function"==typeof Object.create?t.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},{}],4:[function(e,t,n){t.exports=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},{}],5:[function(e,t,n){(function(t,i){(function(){var r=/%[sdj%]/g;n.format=function(e){if(!g(e)){for(var t=[],n=0;n<arguments.length;n++)t.push(l(arguments[n]));return t.join(" ")}n=1;for(var i=arguments,o=i.length,s=String(e).replace(r,(function(e){if("%%"===e)return"%";if(n>=o)return e;switch(e){case"%s":return String(i[n++]);case"%d":return Number(i[n++]);case"%j":try{return JSON.stringify(i[n++])}catch(e){return"[Circular]"}default:return e}})),u=i[n];n<o;u=i[++n])h(u)||!C(u)?s+=" "+u:s+=" "+l(u);return s},n.deprecate=function(e,r){if(y(i.process))return function(){return n.deprecate(e,r).apply(this,arguments)};if(!0===t.noDeprecation)return e;var o=!1;return function(){if(!o){if(t.throwDeprecation)throw new Error(r);t.traceDeprecation?console.trace(r):console.error(r),o=!0}return e.apply(this,arguments)}};var o,s={};function l(e,t){var i={seen:[],stylize:c};return arguments.length>=3&&(i.depth=arguments[2]),arguments.length>=4&&(i.colors=arguments[3]),v(t)?i.showHidden=t:t&&n._extend(i,t),y(i.showHidden)&&(i.showHidden=!1),y(i.depth)&&(i.depth=2),y(i.colors)&&(i.colors=!1),y(i.customInspect)&&(i.customInspect=!0),i.colors&&(i.stylize=u),a(i,e,i.depth)}function u(e,t){var n=l.styles[t];return n?"["+l.colors[n][0]+"m"+e+"["+l.colors[n][1]+"m":e}function c(e,t){return e}function a(e,t,i){if(e.customInspect&&t&&O(t.inspect)&&t.inspect!==n.inspect&&(!t.constructor||t.constructor.prototype!==t)){var r=t.inspect(i,e);return g(r)||(r=a(e,r,i)),r}var o=function(e,t){if(y(t))return e.stylize("undefined","undefined");if(g(t)){var n="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(n,"string")}if(m(t))return e.stylize(""+t,"number");if(v(t))return e.stylize(""+t,"boolean");if(h(t))return e.stylize("null","null")}(e,t);if(o)return o;var s=Object.keys(t),l=function(e){var t={};return e.forEach((function(e,n){t[e]=!0})),t}(s);if(e.showHidden&&(s=Object.getOwnPropertyNames(t)),_(t)&&(s.indexOf("message")>=0||s.indexOf("description")>=0))return d(t);if(0===s.length){if(O(t)){var u=t.name?": "+t.name:"";return e.stylize("[Function"+u+"]","special")}if(b(t))return e.stylize(RegExp.prototype.toString.call(t),"regexp");if(w(t))return e.stylize(Date.prototype.toString.call(t),"date");if(_(t))return d(t)}var c,C="",E=!1,x=["{","}"];(p(t)&&(E=!0,x=["[","]"]),O(t))&&(C=" [Function"+(t.name?": "+t.name:"")+"]");return b(t)&&(C=" "+RegExp.prototype.toString.call(t)),w(t)&&(C=" "+Date.prototype.toUTCString.call(t)),_(t)&&(C=" "+d(t)),0!==s.length||E&&0!=t.length?i<0?b(t)?e.stylize(RegExp.prototype.toString.call(t),"regexp"):e.stylize("[Object]","special"):(e.seen.push(t),c=E?function(e,t,n,i,r){for(var o=[],s=0,l=t.length;s<l;++s)j(t,String(s))?o.push(f(e,t,n,i,String(s),!0)):o.push("");return r.forEach((function(r){r.match(/^\d+$/)||o.push(f(e,t,n,i,r,!0))})),o}(e,t,i,l,s):s.map((function(n){return f(e,t,i,l,n,E)})),e.seen.pop(),function(e,t,n){var i=e.reduce((function(e,t){return t.indexOf("\n")>=0&&0,e+t.replace(/\u001b\[\d\d?m/g,"").length+1}),0);if(i>60)return n[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+n[1];return n[0]+t+" "+e.join(", ")+" "+n[1]}(c,C,x)):x[0]+C+x[1]}function d(e){return"["+Error.prototype.toString.call(e)+"]"}function f(e,t,n,i,r,o){var s,l,u;if((u=Object.getOwnPropertyDescriptor(t,r)||{value:t[r]}).get?l=u.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):u.set&&(l=e.stylize("[Setter]","special")),j(i,r)||(s="["+r+"]"),l||(e.seen.indexOf(u.value)<0?(l=h(n)?a(e,u.value,null):a(e,u.value,n-1)).indexOf("\n")>-1&&(l=o?l.split("\n").map((function(e){return"  "+e})).join("\n").substr(2):"\n"+l.split("\n").map((function(e){return"   "+e})).join("\n")):l=e.stylize("[Circular]","special")),y(s)){if(o&&r.match(/^\d+$/))return l;(s=JSON.stringify(""+r)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(s=s.substr(1,s.length-2),s=e.stylize(s,"name")):(s=s.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),s=e.stylize(s,"string"))}return s+": "+l}function p(e){return Array.isArray(e)}function v(e){return"boolean"==typeof e}function h(e){return null===e}function m(e){return"number"==typeof e}function g(e){return"string"==typeof e}function y(e){return void 0===e}function b(e){return C(e)&&"[object RegExp]"===E(e)}function C(e){return"object"==typeof e&&null!==e}function w(e){return C(e)&&"[object Date]"===E(e)}function _(e){return C(e)&&("[object Error]"===E(e)||e instanceof Error)}function O(e){return"function"==typeof e}function E(e){return Object.prototype.toString.call(e)}function x(e){return e<10?"0"+e.toString(10):e.toString(10)}n.debuglog=function(e){if(y(o)&&(o=t.env.NODE_DEBUG||""),e=e.toUpperCase(),!s[e])if(new RegExp("\\b"+e+"\\b","i").test(o)){var i=t.pid;s[e]=function(){var t=n.format.apply(n,arguments);console.error("%s %d: %s",e,i,t)}}else s[e]=function(){};return s[e]},n.inspect=l,l.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},l.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},n.isArray=p,n.isBoolean=v,n.isNull=h,n.isNullOrUndefined=function(e){return null==e},n.isNumber=m,n.isString=g,n.isSymbol=function(e){return"symbol"==typeof e},n.isUndefined=y,n.isRegExp=b,n.isObject=C,n.isDate=w,n.isError=_,n.isFunction=O,n.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},n.isBuffer=e("./support/isBuffer");var S=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function j(e,t){return Object.prototype.hasOwnProperty.call(e,t)}n.log=function(){var e,t;console.log("%s - %s",(e=new Date,t=[x(e.getHours()),x(e.getMinutes()),x(e.getSeconds())].join(":"),[e.getDate(),S[e.getMonth()],t].join(" ")),n.format.apply(n,arguments))},n.inherits=e("inherits"),n._extend=function(e,t){if(!t||!C(t))return e;for(var n=Object.keys(t),i=n.length;i--;)e[n[i]]=t[n[i]];return e}}).call(this)}).call(this,e("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":4,_process:12,inherits:3}],6:[function(e,t,n){(function(i){(function(){n.formatArgs=function(e){if(e[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+e[0]+(this.useColors?"%c ":" ")+"+"+t.exports.humanize(this.diff),!this.useColors)return;const n="color: "+this.color;e.splice(1,0,n,"color: inherit");let i=0,r=0;e[0].replace(/%[a-zA-Z%]/g,(e=>{"%%"!==e&&(i++,"%c"===e&&(r=i))})),e.splice(r,0,n)},n.save=function(e){try{e?n.storage.setItem("debug",e):n.storage.removeItem("debug")}catch(e){}},n.load=function(){let e;try{e=n.storage.getItem("debug")}catch(e){}!e&&void 0!==i&&"env"in i&&(e=i.env.DEBUG);return e},n.useColors=function(){if("undefined"!=typeof window&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},n.storage=function(){try{return localStorage}catch(e){}}(),n.destroy=(()=>{let e=!1;return()=>{e||(e=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),n.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],n.log=console.debug||console.log||(()=>{}),t.exports=e("./common")(n);const{formatters:r}=t.exports;r.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}}).call(this)}).call(this,e("_process"))},{"./common":7,_process:12}],7:[function(e,t,n){t.exports=function(t){function n(e){let t,r,o,s=null;function l(...e){if(!l.enabled)return;const i=l,r=Number(new Date),o=r-(t||r);i.diff=o,i.prev=t,i.curr=r,t=r,e[0]=n.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let s=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,((t,r)=>{if("%%"===t)return"%";s++;const o=n.formatters[r];if("function"==typeof o){const n=e[s];t=o.call(i,n),e.splice(s,1),s--}return t})),n.formatArgs.call(i,e);(i.log||n.log).apply(i,e)}return l.namespace=e,l.useColors=n.useColors(),l.color=n.selectColor(e),l.extend=i,l.destroy=n.destroy,Object.defineProperty(l,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==s?s:(r!==n.namespaces&&(r=n.namespaces,o=n.enabled(e)),o),set:e=>{s=e}}),"function"==typeof n.init&&n.init(l),l}function i(e,t){const i=n(this.namespace+(void 0===t?":":t)+e);return i.log=this.log,i}function r(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return n.debug=n,n.default=n,n.coerce=function(e){if(e instanceof Error)return e.stack||e.message;return e},n.disable=function(){const e=[...n.names.map(r),...n.skips.map(r).map((e=>"-"+e))].join(",");return n.enable(""),e},n.enable=function(e){let t;n.save(e),n.namespaces=e,n.names=[],n.skips=[];const i=("string"==typeof e?e:"").split(/[\s,]+/),r=i.length;for(t=0;t<r;t++)i[t]&&("-"===(e=i[t].replace(/\*/g,".*?"))[0]?n.skips.push(new RegExp("^"+e.slice(1)+"$")):n.names.push(new RegExp("^"+e+"$")))},n.enabled=function(e){if("*"===e[e.length-1])return!0;let t,i;for(t=0,i=n.skips.length;t<i;t++)if(n.skips[t].test(e))return!1;for(t=0,i=n.names.length;t<i;t++)if(n.names[t].test(e))return!0;return!1},n.humanize=e("ms"),n.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(t).forEach((e=>{n[e]=t[e]})),n.names=[],n.skips=[],n.formatters={},n.selectColor=function(e){let t=0;for(let n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n),t|=0;return n.colors[Math.abs(t)%n.colors.length]},n.enable(n.load()),n}},{ms:10}],8:[function(e,t,n){var i=function(){if("object"==typeof self&&self)return self;if("object"==typeof window&&window)return window;throw new Error("Unable to resolve global `this`")};t.exports=function(){if(this)return this;if("object"==typeof globalThis&&globalThis)return globalThis;try{Object.defineProperty(Object.prototype,"__global__",{get:function(){return this},configurable:!0})}catch(e){return i()}try{return __global__||i()}finally{delete Object.prototype.__global__}}()},{}],9:[function(e,t,n){"use strict";var i,r="object"==typeof Reflect?Reflect:null,o=r&&"function"==typeof r.apply?r.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};i=r&&"function"==typeof r.ownKeys?r.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var s=Number.isNaN||function(e){return e!=e};function l(){l.init.call(this)}t.exports=l,t.exports.once=function(e,t){return new Promise((function(n,i){function r(n){e.removeListener(t,o),i(n)}function o(){"function"==typeof e.removeListener&&e.removeListener("error",r),n([].slice.call(arguments))}g(e,t,o,{once:!0}),"error"!==t&&function(e,t,n){"function"==typeof e.on&&g(e,"error",t,n)}(e,r,{once:!0})}))},l.EventEmitter=l,l.prototype._events=void 0,l.prototype._eventsCount=0,l.prototype._maxListeners=void 0;var u=10;function c(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function a(e){return void 0===e._maxListeners?l.defaultMaxListeners:e._maxListeners}function d(e,t,n,i){var r,o,s,l;if(c(n),void 0===(o=e._events)?(o=e._events=Object.create(null),e._eventsCount=0):(void 0!==o.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),o=e._events),s=o[t]),void 0===s)s=o[t]=n,++e._eventsCount;else if("function"==typeof s?s=o[t]=i?[n,s]:[s,n]:i?s.unshift(n):s.push(n),(r=a(e))>0&&s.length>r&&!s.warned){s.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=e,u.type=t,u.count=s.length,l=u,console&&console.warn&&console.warn(l)}return e}function f(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function p(e,t,n){var i={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},r=f.bind(i);return r.listener=n,i.wrapFn=r,r}function v(e,t,n){var i=e._events;if(void 0===i)return[];var r=i[t];return void 0===r?[]:"function"==typeof r?n?[r.listener||r]:[r]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(r):m(r,r.length)}function h(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function m(e,t){for(var n=new Array(t),i=0;i<t;++i)n[i]=e[i];return n}function g(e,t,n,i){if("function"==typeof e.on)i.once?e.once(t,n):e.on(t,n);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function r(o){i.once&&e.removeEventListener(t,r),n(o)}))}}Object.defineProperty(l,"defaultMaxListeners",{enumerable:!0,get:function(){return u},set:function(e){if("number"!=typeof e||e<0||s(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");u=e}}),l.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},l.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||s(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},l.prototype.getMaxListeners=function(){return a(this)},l.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var i="error"===e,r=this._events;if(void 0!==r)i=i&&void 0===r.error;else if(!i)return!1;if(i){var s;if(t.length>0&&(s=t[0]),s instanceof Error)throw s;var l=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw l.context=s,l}var u=r[e];if(void 0===u)return!1;if("function"==typeof u)o(u,this,t);else{var c=u.length,a=m(u,c);for(n=0;n<c;++n)o(a[n],this,t)}return!0},l.prototype.addListener=function(e,t){return d(this,e,t,!1)},l.prototype.on=l.prototype.addListener,l.prototype.prependListener=function(e,t){return d(this,e,t,!0)},l.prototype.once=function(e,t){return c(t),this.on(e,p(this,e,t)),this},l.prototype.prependOnceListener=function(e,t){return c(t),this.prependListener(e,p(this,e,t)),this},l.prototype.removeListener=function(e,t){var n,i,r,o,s;if(c(t),void 0===(i=this._events))return this;if(void 0===(n=i[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(r=-1,o=n.length-1;o>=0;o--)if(n[o]===t||n[o].listener===t){s=n[o].listener,r=o;break}if(r<0)return this;0===r?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,r),1===n.length&&(i[e]=n[0]),void 0!==i.removeListener&&this.emit("removeListener",e,s||t)}return this},l.prototype.off=l.prototype.removeListener,l.prototype.removeAllListeners=function(e){var t,n,i;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var r,o=Object.keys(n);for(i=0;i<o.length;++i)"removeListener"!==(r=o[i])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(i=t.length-1;i>=0;i--)this.removeListener(e,t[i]);return this},l.prototype.listeners=function(e){return v(this,e,!0)},l.prototype.rawListeners=function(e){return v(this,e,!1)},l.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):h.call(e,t)},l.prototype.listenerCount=h,l.prototype.eventNames=function(){return this._eventsCount>0?i(this._events):[]}},{}],10:[function(e,t,n){var i=1e3,r=60*i,o=60*r,s=24*o,l=7*s,u=365.25*s;function c(e,t,n,i){var r=t>=1.5*n;return Math.round(e/n)+" "+i+(r?"s":"")}t.exports=function(e,t){t=t||{};var n=typeof e;if("string"===n&&e.length>0)return function(e){if((e=String(e)).length>100)return;var t=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(!t)return;var n=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return n*u;case"weeks":case"week":case"w":return n*l;case"days":case"day":case"d":return n*s;case"hours":case"hour":case"hrs":case"hr":case"h":return n*o;case"minutes":case"minute":case"mins":case"min":case"m":return n*r;case"seconds":case"second":case"secs":case"sec":case"s":return n*i;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n;default:return}}(e);if("number"===n&&isFinite(e))return t.long?function(e){var t=Math.abs(e);if(t>=s)return c(e,t,s,"day");if(t>=o)return c(e,t,o,"hour");if(t>=r)return c(e,t,r,"minute");if(t>=i)return c(e,t,i,"second");return e+" ms"}(e):function(e){var t=Math.abs(e);if(t>=s)return Math.round(e/s)+"d";if(t>=o)return Math.round(e/o)+"h";if(t>=r)return Math.round(e/r)+"m";if(t>=i)return Math.round(e/i)+"s";return e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},{}],11:[function(e,t,n){
/*
object-assign
(c) Sindre Sorhus
@license MIT
*/
"use strict";var i=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable;t.exports=function(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},n=0;n<10;n++)t["_"+String.fromCharCode(n)]=n;if("0123456789"!==Object.getOwnPropertyNames(t).map((function(e){return t[e]})).join(""))return!1;var i={};return"abcdefghijklmnopqrst".split("").forEach((function(e){i[e]=e})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},i)).join("")}catch(e){return!1}}()?Object.assign:function(e,t){for(var n,s,l=function(e){if(null==e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}(e),u=1;u<arguments.length;u++){for(var c in n=Object(arguments[u]))r.call(n,c)&&(l[c]=n[c]);if(i){s=i(n);for(var a=0;a<s.length;a++)o.call(n,s[a])&&(l[s[a]]=n[s[a]])}}return l}},{}],12:[function(e,t,n){var i,r,o=t.exports={};function s(){throw new Error("setTimeout has not been defined")}function l(){throw new Error("clearTimeout has not been defined")}function u(e){if(i===setTimeout)return setTimeout(e,0);if((i===s||!i)&&setTimeout)return i=setTimeout,setTimeout(e,0);try{return i(e,0)}catch(t){try{return i.call(null,e,0)}catch(t){return i.call(this,e,0)}}}!function(){try{i="function"==typeof setTimeout?setTimeout:s}catch(e){i=s}try{r="function"==typeof clearTimeout?clearTimeout:l}catch(e){r=l}}();var c,a=[],d=!1,f=-1;function p(){d&&c&&(d=!1,c.length?a=c.concat(a):f=-1,a.length&&v())}function v(){if(!d){var e=u(p);d=!0;for(var t=a.length;t;){for(c=a,a=[];++f<t;)c&&c[f].run();f=-1,t=a.length}c=null,d=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===l||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function h(e,t){this.fun=e,this.array=t}function m(){}o.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];a.push(new h(e,t)),1!==a.length||d||u(v)},h.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=m,o.addListener=m,o.once=m,o.off=m,o.removeListener=m,o.removeAllListeners=m,o.emit=m,o.prependListener=m,o.prependOnceListener=m,o.listeners=function(e){return[]},o.binding=function(e){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(e){throw new Error("process.chdir is not supported")},o.umask=function(){return 0}},{}],13:[function(e,t,n){var i;if("object"==typeof globalThis)i=globalThis;else try{i=e("es5-ext/global")}catch(e){}finally{if(i||"undefined"==typeof window||(i=window),!i)throw new Error("Could not determine global this")}var r=i.WebSocket||i.MozWebSocket,o=e("./version");function s(e,t){return t?new r(e,t):new r(e)}r&&["CONNECTING","OPEN","CLOSING","CLOSED"].forEach((function(e){Object.defineProperty(s,e,{get:function(){return r[e]}})})),t.exports={w3cwebsocket:r?s:null,version:o}},{"./version":14,"es5-ext/global":8}],14:[function(e,t,n){t.exports=e("../package.json").version},{"../package.json":15}],15:[function(e,t,n){t.exports={name:"websocket",description:"Websocket Client & Server Library implementing the WebSocket protocol as specified in RFC 6455.",keywords:["websocket","websockets","socket","networking","comet","push","RFC-6455","realtime","server","client"],author:"Brian McKelvey <theturtle32@gmail.com> (https://github.com/theturtle32)",contributors:["IÃ±aki Baz Castillo <ibc@aliax.net> (http://dev.sipdoc.net)"],version:"1.0.34",repository:{type:"git",url:"https://github.com/theturtle32/WebSocket-Node.git"},homepage:"https://github.com/theturtle32/WebSocket-Node",engines:{node:">=4.0.0"},dependencies:{bufferutil:"^4.0.1",debug:"^2.2.0","es5-ext":"^0.10.50","typedarray-to-buffer":"^3.1.5","utf-8-validate":"^5.0.2",yaeti:"^0.0.6"},devDependencies:{"buffer-equal":"^1.0.0",gulp:"^4.0.2","gulp-jshint":"^2.0.4","jshint-stylish":"^2.2.1",jshint:"^2.0.0",tape:"^4.9.1"},config:{verbose:!1},scripts:{test:"tape test/unit/*.js",gulp:"gulp"},main:"index",directories:{lib:"./lib"},browser:"lib/browser.js",license:"Apache-2.0"}},{}],16:[function(e,t,n){"use strict";t.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},{}],"xrpl-client":[function(e,t,n){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,i,r)}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),r=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||i(t,e,n)},o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function s(e){try{u(i.next(e))}catch(e){o(e)}}function l(e){try{u(i.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,l)}u((i=i.apply(e,t||[])).next())}))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.XrplClient=n.defaultEndpoints=void 0;const l=s(e("assert")),u=e("events"),c=e("debug"),a=e("websocket");r(e("./types"),n);const d=(0,c.debug)("xrplclient"),f=d.extend("warning"),p=d.extend("message"),v=d.extend("node");n.defaultEndpoints=["wss://xrplcluster.com","wss://xrpl.link","wss://s2.ripple.com"];class h extends u.EventEmitter{constructor(t,i){var r;let s;super(),this.eventBus=new u.EventEmitter,this.closed=!1,this.destroyed=!1,this.uplinkReady=!1,this.options={connectAttemptTimeoutSeconds:3,assumeOfflineAfterSeconds:15,maxConnectionAttempts:null,feeDropsDefault:12,feeDropsMax:3600,tryAllNodes:false},this.callId=0,this.pendingCalls=[],this.subscriptions=[],this.networkDefinitions=null,this.serverState={validatedLedgers:"",reserveBase:null,reserveInc:null,latency:[],fee:[],connectAttempts:-1,networkId:0},i&&Object.assign(this.options,i),this.endpoints=(e=>{let t=[];return e&&(t=[...new Set(Array.isArray(e)?e:[e])].map((e=>e.trim())).filter((e=>e.match(/^ws[s]{0,1}:\/\//)))),t.length<1&&(t=n.defaultEndpoints,f("No valid WebSocket endpoint(s) specified, falling back to defaults",t)),t})(t);const c=()=>{var e;clearTimeout(s);const t=1e3*Number((null===(e=null==this?void 0:this.options)||void 0===e?void 0:e.assumeOfflineAfterSeconds)||15);s=setTimeout((()=>{var e;if(this.uplinkReady){f(`Conn. TIMEOUT, no ledger for ${t} sec.`);try{d("Close #6"),null===(e=null==this?void 0:this.connection)||void 0===e||e.close()}catch(e){}}}),t)};c();const h=()=>{var e,t;let n=1;const i=(null===(e=this.options)||void 0===e?void 0:e.maxConnectionAttempts)||null;i&&(n=(((null===(t=this.options)||void 0===t?void 0:t.connectAttemptTimeoutSeconds)||3)-1)/(i-1));return Math.max(1.5,(this.serverState.connectAttempts+1)*n)};this.endpoint=this.endpoints[0].trim(),this.endpoints.length>1&&!(null===(r=this.options)||void 0===r?void 0:r.maxConnectionAttempts)&&(d(`Multiple endpoints (${this.endpoints.length}) and no maxConnection attempts, set (3)`),Object.assign(this.options,{maxConnectionAttempts:3})),d("Initialized xrpld WebSocket Client"),this.on("ledger",(()=>{g(),c()}));const m=()=>{},g=()=>{this.uplinkReady||(this.serverState.connectAttempts=0,v("Connection ready, fire events"),this.uplinkReady=!0,this.eventBus.emit("flush"),this.emit("online"),this.emit("state",this.getState()))},y=()=>{var e,t,n;if(this.closed||(null===(e=null==this?void 0:this.connection)||void 0===e?void 0:e.readyState)!==a.w3cwebsocket.OPEN)try{d("Close #1"),null===(n=null==this?void 0:this.connection)||void 0===n||n.close()}catch(e){}else{if(d("Connection opened :)"),this.endpoint.match(/^wss:\/\/(xrplcluster\.com|xrpl\.link|xrpl\.ws)/))try{null===(t=null==this?void 0:this.connection)||void 0===t||t.send(JSON.stringify({__api:"state",origin:"xrpl-client@js/ts"}))}catch(e){}this.send({id:"_WsClient_Internal_Subscription",command:"subscribe",streams:["ledger"]},{sendIfNotReady:!0,noReplayAfterReconnect:!0}).then(m,m),this.send({id:"_WsClient_Internal_ServerInfo@"+Number(new Date),command:"server_info"},{sendIfNotReady:!0,noReplayAfterReconnect:!0}).then((()=>{g()}),m)}},b=e=>{this.emit("close"),this.emit("state",this.getState()),this.uplinkReady&&(this.emit("offline"),this.endpoint=this.endpoints[0]),this.uplinkReady=!1,this.serverInfo=void 0,f("Upstream/Websocket closed",null==e?void 0:e.code,null==e?void 0:e.reason),A(),this.closed?d("Closed on purpose, not reconnecting"):(this.emit("retry"),f(`Not closed on purpose, reconnecting after ${h()}...`),setTimeout((()=>{this.eventBus.emit("reconnect")}),1e3*h()))},C=(e,t=!1)=>{var n,i,r,o,s,l,u,c,a,d,f,p,h;if(null===(n=null==e?void 0:e.result)||void 0===n?void 0:n.info){const n=t?Object.assign({},this.serverState):this.serverState,m=e;this.serverInfo||t||v("Connected, server_info:",{pubkey_node:m.result.info.pubkey_node,network_id:(null===(i=m.result.info)||void 0===i?void 0:i.network_id)||0,build_version:m.result.info.build_version,complete_ledgers:m.result.info.complete_ledgers}),(null===(s=null===(o=null===(r=null==m?void 0:m.result)||void 0===r?void 0:r.info)||void 0===o?void 0:o.validated_ledger)||void 0===s?void 0:s.reserve_base_xrp)&&(n.reserveBase=Number(m.result.info.validated_ledger.reserve_base_xrp)||null),(null===(c=null===(u=null===(l=null==m?void 0:m.result)||void 0===l?void 0:l.info)||void 0===u?void 0:u.validated_ledger)||void 0===c?void 0:c.reserve_inc_xrp)&&(n.reserveInc=Number(m.result.info.validated_ledger.reserve_inc_xrp)||null),(null===(d=null===(a=null==m?void 0:m.result)||void 0===a?void 0:a.info)||void 0===d?void 0:d.complete_ledgers)&&(n.validatedLedgers=m.result.info.complete_ledgers),(null===(f=null==m?void 0:m.result)||void 0===f?void 0:f.info)&&(n.networkId=m.result.info.network_id||0);const g=Number(new Date)-Number(String((null==e?void 0:e.id)||"").split("@").reverse()[0]);g&&(n.latency.push({moment:new Date,value:g}),n.latency.splice(0,n.latency.length-10));const y=1e6*Number((null===(h=null===(p=m.result.info)||void 0===p?void 0:p.validated_ledger)||void 0===h?void 0:h.base_fee_xrp)||(this.options.feeDropsDefault||12)/1e6)*1.2;if(y&&y<=(this.options.feeDropsMax||3600)&&(n.fee.push({moment:new Date,value:y}),n.fee.splice(0,n.fee.length-5)),t)return{serverInfo:m,serverState:n};this.serverInfo=m}},w=e=>{var t,n,i,r,o,s,l,u,c,a;if("_WsClient_Internal_Subscription"!==(null===(t=null==e?void 0:e.id)||void 0===t?void 0:t._Request)){let t;if(null===(n=null==e?void 0:e.id)||void 0===n?void 0:n._WsClient){const n=this.subscriptions.filter((t=>{var n;return t.id===(null===(n=null==e?void 0:e.id)||void 0===n?void 0:n._WsClient)}));n.length>0&&(t=n[0],t.promiseCallables.resolve(Object.assign(e,{id:null===(i=null==e?void 0:e.id)||void 0===i?void 0:i._Request})))}if(this.emit("message",e),"ledgerClosed"===(null==e?void 0:e.type)&&"string"==typeof(null==e?void 0:e.validated_ledgers))p("Async",e.type),Object.assign(this.serverState,{validatedLedgers:e.validated_ledgers,reserveBase:Number(null==e?void 0:e.reserve_base)/1e6||null,reserveInc:Number(null==e?void 0:e.reserve_inc)/1e6||null}),this.emit("ledger",e),this.send({id:"_WsClient_Internal_ServerInfo@"+Number(new Date),command:"server_info"}).then(m,m);else if("path_find"===(null==e?void 0:e.type))p("Async",e.type),this.emit("path",e);else if("transaction"===(null==e?void 0:e.type))p("Async",e.type),this.emit("transaction",e);else if(null==e?void 0:e.validation_public_key)p("Async","validation"),this.emit("validation",e);else if("path_find"===(null===(r=null==t?void 0:t.request)||void 0===r?void 0:r.command))p("Async",null===(o=null==t?void 0:t.request)||void 0===o?void 0:o.command),this.emit("path",e);else if("subscribe"===(null===(s=null==t?void 0:t.request)||void 0===s?void 0:s.command)&&Array.isArray(null===(l=null==t?void 0:t.request)||void 0===l?void 0:l.streams)&&(null===(u=null==t?void 0:t.request)||void 0===u?void 0:u.streams.indexOf("ledger"))>-1)p("Async","subscription:ledger"),this.emit("ledger",(null==e?void 0:e.result)?e.result:e);else if(t);else{if(!((null===(c=null==e?void 0:e.id)||void 0===c?void 0:c._Request)&&String(e.id._Request).match(/^_WsClient_Internal/))){try{const t=e;if("PROXY"===(null==t?void 0:t.type))return this.clusterInfo_=t,void this.emit("clusterinfo",this.clusterInfo_)}catch(e){}p("Handle <UNKNOWN> Async Message",{internalId:null===(a=null==e?void 0:e.id)||void 0===a?void 0:a._WsClient,matchingSubscription:t,type:null==e?void 0:e.type,message:e})}}}},_=e=>{var t,n,i,r,o,s;try{(0,l.default)("string"==typeof e.data,"Unexpected incoming WebSocket message data type");const u=JSON.parse(e.data);if(this.lastContact=new Date,null===(t=null==u?void 0:u.id)||void 0===t?void 0:t._WsClient){const e=this.subscriptions.filter((e=>{var t;return e.id===(null===(t=null==u?void 0:u.id)||void 0===t?void 0:t._WsClient)})),t=this.pendingCalls.filter((e=>{var t;return e.id===(null===(t=null==u?void 0:u.id)||void 0===t?void 0:t._WsClient)}));if(1===e.length)w(u);else if(1===t.length){const e="_WsClient_Internal_ServerInfo"===String((null===(r=null===(i=null===(n=t[0])||void 0===n?void 0:n.request)||void 0===i?void 0:i.id)||void 0===r?void 0:r._Request)||"").split("@")[0];Object.assign(u,{id:null===(o=null==u?void 0:u.id)||void 0===o?void 0:o._Request}),(null===(s=t[0].sendOptions)||void 0===s?void 0:s.timeoutSeconds)&&t[0].timeout&&clearTimeout(t[0].timeout),t[0].promiseCallables.resolve((null==u?void 0:u.result)||u),this.pendingCalls.splice(this.pendingCalls.indexOf(t[0]),1),e?C(u):d("Â» Pending Call Length",this.pendingCalls.length)}else w(u)}else w(u)}catch(e){f("Uplink response: parse error",e.message)}},O=e=>{f("Upstream/Websocket error")},E=e=>{var t;(null===(t=null==e?void 0:e.sendOptions)||void 0===t?void 0:t.timeoutSeconds)&&!(null==e?void 0:e.timeout)&&Object.assign(e,{timeout:setTimeout((()=>o(this,void 0,void 0,(function*(){var t;"_WsClient_Internal_CallResolved"===(yield Promise.race([e.promise,Promise.resolve("_WsClient_Internal_CallResolved")]))&&e.promiseCallables.reject(new Error(`Call timeout after ${null===(t=e.sendOptions)||void 0===t?void 0:t.timeoutSeconds} seconds`))}))),1e3*Number(e.sendOptions.timeoutSeconds))})},x=e=>{var t,n,i,r;"_WsClient_Internal_ServerInfo"!==String((null===(n=null===(t=null==e?void 0:e.request)||void 0===t?void 0:t.id)||void 0===n?void 0:n._Request)||"").split("@")[0]&&d("  > Process call",e.id,e.request.command);try{null===(i=null==this?void 0:this.connection)||void 0===i||i.send(JSON.stringify(e.request)),(null===(r=null==e?void 0:e.sendOptions)||void 0===r?void 0:r.timeoutStartsWhenOnline)&&E(e)}catch(e){f("Process (send to uplink) error",e.message)}},S=e=>{var t,n,i,r,o;"_WsClient_Internal_ServerInfo"!==String((null===(n=null===(t=null==e?void 0:e.request)||void 0===t?void 0:t.id)||void 0===n?void 0:n._Request)||"").split("@")[0]&&d(`Call ${e.id}: ${e.request.command}\n   > `,this.uplinkReady?"Uplink ready, pass immediately":(null===(i=null==e?void 0:e.sendOptions)||void 0===i?void 0:i.sendIfNotReady)?"Uplink not flagged as ready yet, but `sendIfNotReady` = true, so go ahead":"Uplink not ready, wait for flush"),(null===(r=null==e?void 0:e.sendOptions)||void 0===r?void 0:r.timeoutStartsWhenOnline)||E(e),(this.uplinkReady||(null===(o=null==e?void 0:e.sendOptions)||void 0===o?void 0:o.sendIfNotReady))&&x(e)},j=()=>{d("Connected, flushing pending calls & subscriptions"),this.pendingCalls.forEach((e=>{x(e)})),this.subscriptions.forEach((e=>{x(e)}))},k=e=>{(0,l.default)(!this.destroyed,"Object is in destroyed state"),d("Reinstating..., options:",e||{}),(null==e?void 0:e.forceNextUplink)?(this.uplinkReady=!1,clearTimeout(s),I()):(this.closed=!1,c()),L()},F=e=>{var t;d("Closing connection"),this.emit("close"),this.closed=!0;try{d("Close #2"),null===(t=null==this?void 0:this.connection)||void 0===t||t.close()}catch(e){}clearTimeout(s),e&&this.emit("error",e)},N=e=>{this.destroyed=!0,F(e),A(),this.subscriptions.forEach((e=>{e.promiseCallables.reject(new Error("Class (connection) hard close requested"))})),this.pendingCalls.forEach((e=>{e.promiseCallables.reject(new Error("Class (connection) hard close requested"))})),this.eventBus.off("__WsClient_call",S),this.eventBus.off("__WsClient_destroy",N),this.eventBus.off("__WsClient_close",F),this.eventBus.off("__WsClient_reinstate",k),this.eventBus.off("flush",j),this.eventBus.off("reconnect",L)},A=()=>{d("Cleanup"),(null==this?void 0:this.connection).removeEventListener("open",y),(null==this?void 0:this.connection).removeEventListener("message",_),(null==this?void 0:this.connection).removeEventListener("error",O),(null==this?void 0:this.connection).removeEventListener("close",b)},I=()=>{const e=this.endpoints.indexOf(this.endpoint)+1;f("--- Current endpoint",this.endpoint),this.endpoint=this.endpoints[e>=this.endpoints.length?0:e],f("--- New endpoint",this.endpoint),this.serverState.connectAttempts=0,this.emit("nodeswitch",this.endpoint),e>=this.endpoints.length&&this.emit("round")},L=()=>{var t,n,i,r;try{d("Close #3"),A(),null===(t=null==this?void 0:this.connection)||void 0===t||t.close()}catch(e){}if(d("connect()",this.endpoint),this.serverState.connectAttempts++,this.options.maxConnectionAttempts&&Number((null===(n=this.options)||void 0===n?void 0:n.maxConnectionAttempts)||1)>1&&this.serverState.connectAttempts>=Number((null===(i=this.options)||void 0===i?void 0:i.maxConnectionAttempts)||1)&&(v("Too many connection attempts",this.serverState.connectAttempts,null===(r=this.options)||void 0===r?void 0:r.maxConnectionAttempts),d(this.endpoint,this.endpoints,this.endpoints.length,this.endpoints.indexOf(this.endpoint)),this.endpoints.length>1&&this.endpoints.indexOf(this.endpoint)>-1?(f("Multiple endpoints, max. connection attempts exceeded. Switch endpoint."),I()):(f("Only one valid endpoint, after the max. connection attempts: game over"),F(new Error("Max. connection attempts exceeded")))),!this.closed){this.options.tryAllNodes&&f("!!!".repeat(30)+"\n!!!\n!!!    Trying all nodes. WARNING! IF YOU DO NOT EXPLICITLY NEED THIS,\n!!!    DO NOT USE THE `tryAllNodes` OPTION (to prevent wasting resources)\n!!!\n"+"!!!".repeat(30)+"\n");const t=(this.options.tryAllNodes?this.endpoints:[this.endpoint]).map((n=>{var i,r;d("Connecting",n);let o="undefined"!=typeof WebSocket?WebSocket:a.w3cwebsocket;if(void 0!==e)try{o=e("ws").default}catch(e){}const s=new(typeof o!=typeof _NA_?o:a.w3cwebsocket)(n,void 0,void 0,Object.assign((null===(i=this.options)||void 0===i?void 0:i.httpHeaders)||{},{"user-agent":"xrpl-client@js/ts"}),(null===(r=this.options)||void 0===r?void 0:r.httpRequestOptions)||{},{maxReceivedFrameSize:2147483648,maxReceivedMessageSize:8589934592});setTimeout((()=>{var e;s.readyState!==a.w3cwebsocket.OPEN&&(null===(e=this.connection)||void 0===e?void 0:e.readyState)!==a.w3cwebsocket.OPEN&&(d("Close #4 -- FORCED, inner connection timeout"),s.close(),this.options.tryAllNodes?0===this.endpoints.indexOf(n)&&this.eventBus.emit("reconnect"):this.eventBus.emit("reconnect"))}),1e3*h()-1);const u=()=>{d("OPEN",n),s.send(JSON.stringify({command:"server_info"}))},c=e=>{var i;(0,l.default)("string"==typeof e.data,"Unexpected incoming WebSocket message data type");const r=JSON.parse(e.data),o=C(r,!0);if(o){const r=this.getState(o.serverState);"number"==typeof r.ledger.last&&(Number(r.ledger.count||0)||0)>0&&(v("Race won by endpoint:",{endpoint:n,build_version:o.serverInfo.result.info.build_version,complete_ledgers:o.serverInfo.result.info.complete_ledgers,pubkey_node:o.serverInfo.result.info.pubkey_node,network_id:(null===(i=o.serverInfo.result.info)||void 0===i?void 0:i.network_id)||0}),this.connection=s,this.endpoint=n,y(),_(e),t.forEach((e=>{e.removeEventListener("open",u),e.removeEventListener("message",c),e!=s?(d("Close #5"),e.close(),v("Cleanup: closing connection & clearing event listeners for lost race connection",e.url)):v("Cleanup: cleared event listeners for winning node",e.url)})),s.addEventListener("open",y),s.addEventListener("message",_),s.addEventListener("error",O),s.addEventListener("close",b))}};return s.addEventListener("open",u),s.addEventListener("message",c),s}))}return null==this?void 0:this.connection};this.eventBus.on("__WsClient_call",S),this.eventBus.on("__WsClient_destroy",N),this.eventBus.on("__WsClient_close",F),this.eventBus.on("__WsClient_reinstate",k),this.eventBus.on("flush",j),this.eventBus.on("reconnect",L),L()}ready(){return new Promise(((e,t)=>{const n=this.getState();if(n.online&&n.secLastContact&&n.secLastContact<10&&n.ledger.last)return e(this);this.on("ledger",(()=>{e(this)}))}))}definitions(){var e;return o(this,void 0,void 0,(function*(){if(null===this.networkDefinitions){yield this.ready();const e=yield this.send({command:"server_definitions"});if("object"==typeof(null==e?void 0:e.FIELDS))return this.networkDefinitions=e,this.networkDefinitions;("string"==typeof(null==e?void 0:e.status)&&e.status.match(/error/i)||"string"==typeof(null==e?void 0:e.error)&&e.error.match(/unknown/i))&&(this.networkDefinitions={})}return"object"==typeof(null===(e=this.networkDefinitions)||void 0===e?void 0:e.FIELDS)?this.networkDefinitions:null}))}send(e,t={}){var n,i,r;return o(this,void 0,void 0,(function*(){const o=Object.assign({},e);(0,l.default)("object"==typeof o&&o,"`send()`: expecting object containing `command`"),(0,l.default)("string"==typeof o.command,"`command` must be typeof string"),this.callId++;const s={resolve:e=>{},reject:e=>{}},u=new Promise(((t,n)=>{Object.assign(s,{resolve:n=>(Object.defineProperty(n,"id",{enumerable:!1,writable:!1,value:null==e?void 0:e.id}),t(n)),reject:n})})),c={id:this.callId,request:Object.assign(o,{id:{_WsClient:this.callId,_Request:null==o?void 0:o.id},command:o.command.toLowerCase().trim()}),promise:u,promiseCallables:s,sendOptions:t};if(this.destroyed)return s.reject(new Error("Client in destroyed state")),u;const a=("subscribe"===c.request.command||"unsubscribe"===c.request.command||"path_find"===c.request.command)&&!(null==t?void 0:t.noReplayAfterReconnect);return"unsubscribe"===(null===(n=c.request)||void 0===n?void 0:n.command)&&Array.isArray(null===(i=c.request)||void 0===i?void 0:i.streams)&&(null===(r=c.request)||void 0===r?void 0:r.streams.indexOf("ledger"))>-1&&(c.request.streams.splice(c.request.streams.indexOf("ledger"),1),0===c.request.streams.length&&0===Object.keys(c.request).filter((e=>"id"!==e&&"streams"!==e&&"command"!==e)).length)?Promise.reject(new Error("Unsubscribing from (just) the ledger stream is not allowed")):("_WsClient_Internal_ServerInfo"!==String((null==o?void 0:o.id)||"").split("@")[0]&&this[a?"subscriptions":"pendingCalls"].push(c),this.eventBus.emit("__WsClient_call",c),u)}))}getState(e){var t,n,i,r,o,s,l,u,c,d,f,p,v;const h=e||this.serverState,m=h.validatedLedgers.split(",").map((e=>{const t=e.split("-");return t.length>1?parseInt(t[1])-parseInt(t[0]):1})).reduce(((e,t)=>e+t),0);return{online:this.uplinkReady&&!this.closed&&(null===(t=null==this?void 0:this.connection)||void 0===t?void 0:t.readyState)===a.w3cwebsocket.OPEN,latencyMs:{last:h.latency.slice(-1).map((e=>e.value))[0]||null,avg:h.latency.map((e=>e.value)).reduce(((e,t)=>e+t),0)/h.latency.length||null,secAgo:Number(new Date)/1e3-h.latency.slice(-1).map((e=>Number(e.moment)/1e3))[0]||null},server:{version:(null===(r=null===(i=null===(n=this.serverInfo)||void 0===n?void 0:n.result)||void 0===i?void 0:i.info)||void 0===r?void 0:r.build_version)||"",uptime:(null===(l=null===(s=null===(o=this.serverInfo)||void 0===o?void 0:o.result)||void 0===s?void 0:s.info)||void 0===l?void 0:l.uptime)||0,publicKey:(null===(d=null===(c=null===(u=this.serverInfo)||void 0===u?void 0:u.result)||void 0===c?void 0:c.info)||void 0===d?void 0:d.pubkey_node)||"",networkId:(null===(v=null===(p=null===(f=this.serverInfo)||void 0===f?void 0:f.result)||void 0===p?void 0:p.info)||void 0===v?void 0:v.network_id)||0,uri:this.endpoint},ledger:{last:Number(h.validatedLedgers.split(",").reverse()[0].split("-").reverse()[0]),validated:h.validatedLedgers,count:""===h.validatedLedgers?0:m},fee:{last:h.fee.slice(-1).map((e=>e.value))[0]||this.options.feeDropsDefault||12,avg:h.fee.map((e=>e.value)).reduce(((e,t)=>e+t),0)/h.fee.length||this.options.feeDropsDefault||12,secAgo:Number(new Date)/1e3-h.fee.slice(-1).map((e=>Number(e.moment)/1e3))[0]||null},reserve:{base:h.reserveBase,owner:h.reserveInc},secLastContact:this.lastContact?Number(new Date)/1e3-Number(this.lastContact)/1e3:null}}close(){d("> CLOSE"),this.eventBus.emit("__WsClient_close")}reinstate(e){d("> REINSTATE"),this.eventBus.emit("__WsClient_reinstate",e)}destroy(){d("> DESTROY"),this.eventBus.emit("__WsClient_destroy")}clusterInfo(){return new Promise(((e,t)=>{if(this.clusterInfo_)return e(this.clusterInfo_);this.on("clusterinfo",(t=>{e(t)}))}))}}n.XrplClient=h},{"./types":1,assert:2,debug:6,events:9,websocket:13,ws:16}]},{},[]);
